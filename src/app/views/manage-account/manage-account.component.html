<!--Popovers-->
<ng-template #popBasic><small>Ctrl+Shift+</small><strong>{{keyCodes.accBasic.letter}}</strong></ng-template>
<ng-template #popCollection><small>Ctrl+Shift+</small><strong>{{keyCodes.accCollection.letter}}</strong></ng-template>
<ng-template #popLoan><small>Ctrl+Shift+</small><strong>{{keyCodes.accLoan.letter}}</strong></ng-template>
<ng-template #popLossMitigation><small>Ctrl+Shift+</small><strong>{{keyCodes.accLossMitigation.letter}}</strong></ng-template>
<ng-template #popBankruptcy><small>Ctrl+Shift+</small><strong>{{keyCodes.accBankruptcy.letter}}</strong></ng-template>
<ng-template #popForeclosure><small>Ctrl+Shift+</small><strong>{{keyCodes.accForeclosure.letter}}</strong></ng-template>
<ng-template #popAdditional><small>Ctrl+Shift+</small><strong>{{keyCodes.accAddtitional.letter}}</strong></ng-template>
<ng-template #popHistory><small>Ctrl+Shift+</small><strong>{{keyCodes.accHistory.letter}}</strong></ng-template>

<ng-template #popAccounts><small>Ctrl+Shift+</small><strong>{{keyCodes.addAccounts.letter}}</strong></ng-template>
<ng-template #popCoborrowers><small>Ctrl+Shift+</small><strong>{{keyCodes.addCoborrowers.letter}}</strong></ng-template>

<ng-template #popCalls><small>Ctrl+Shift+</small><strong>{{keyCodes.ctCalls.letter}}</strong></ng-template>
<ng-template #popNotes><small>Ctrl+Shift+</small><strong>{{keyCodes.ctNotes.letter}}</strong></ng-template>
<ng-template #popAlerts><small>Ctrl+Shift+</small><strong>{{keyCodes.ctAlerts.letter}}</strong></ng-template>

<ng-template #newCallToggle><small>Ctrl+Shift+</small><strong>{{keyCodes.toggleNewCall.letter}}</strong></ng-template>

<!--<xmpp-debugger></xmpp-debugger>-->

<div class="row">
  <div class="col-lg-7">
    <div class="ibox">
      <div class="ibox-title">
        <h5>Customer Details And <span *ngIf="!isDepositAccountType">Loan</span>
          <span *ngIf="isDepositAccountType">Deposit</span> Info</h5>
        <iboxtools></iboxtools>
      </div>
      <div class="ibox-content" *ngIf="!searchingAccountInfo">
        <div id="container" class="row">
          <div class="col-lg-12">
            <ngb-tabset #tabSetAccount>

              <ngb-tab id="accountBasic">
                <ng-template ngbTabTitle><span [popover]="popBasic" triggers="">Basic</span></ng-template>
                <ng-template ngbTabContent>
                  <p></p>
                  <customer-detail [customer]="account?.customer"
                                   [account]="account"
                                   [searching]="searchingCustomer"
                                   [searchingSSN]="searchingCoborrowers"
                                   [searchingAccountDepInfo]="searchingAccountDepInfo"
                                   (onCall)="makeCall($event)">
                  </customer-detail>
                  <!--<button class="btn btn-lg btn-outline-primary" (click)="open(content)">Launch demo modal</button> Close: {{closeResult}}-->
                </ng-template>
              </ngb-tab>

              <!--(click)="hideNotify($event)"-->
              <ngb-tab id="accountCollection" *ngIf="!isDepositAccountType">
                <ng-template ngbTabTitle>
                  <span id="collection" [popover]="popCollection" placement="bottom" triggers="">Collection <notification-tab *ngIf="isNotifyActive()" [accountCol]="account?.collection"></notification-tab></span></ng-template>
                <ng-template ngbTabContent>
                  <p></p>
                  <account-collection
                    [isMemo]="memoInText"
                    [accountCol]="account?.collection"
                    (onHide)="showIcon(false)">
                  </account-collection>
                </ng-template>
              </ngb-tab>

              <ngb-tab id="accountLoan" *ngIf="!isDepositAccountType">
                <ng-template ngbTabTitle><span [popover]="popLoan" triggers="">Loan</span></ng-template>
                <ng-template ngbTabContent>
                  <p></p>
                  <account-loan
                    [accountLoan]="account?.loan">
                  </account-loan>
                </ng-template>
              </ngb-tab>

              <ngb-tab  id="accountLossMitigation" *ngIf="!isDepositAccountType">
                <ng-template ngbTabTitle><span [popover]="popLossMitigation" placement="bottom" triggers="">Loss mitigation</span></ng-template>
                <ng-template ngbTabContent>
                  <p></p>
                  <account-loss-mitigation [accountLoss]="account?.lossMitigation"></account-loss-mitigation>
                </ng-template>
              </ngb-tab>

              <ngb-tab id="accountBankruptcy" *ngIf="!isDepositAccountType">
                <ng-template ngbTabTitle><span [popover]="popBankruptcy" triggers="">Bankruptcy</span></ng-template>
                <ng-template ngbTabContent>
                  <p></p>
                  <account-bakruptcy [accountBankrup]="account?.bankruptcy"></account-bakruptcy>
                </ng-template>
              </ngb-tab>

              <ngb-tab id="accountForeclosure" *ngIf="!isDepositAccountType">
                <ng-template ngbTabTitle><span [popover]="popForeclosure" placement="bottom" triggers="">Foreclosure</span></ng-template>
                <ng-template ngbTabContent>
                  <p></p>
                  <account-foreclosure [accountFore]="account?.foreclosure"></account-foreclosure>
                </ng-template>
              </ngb-tab>

              <ngb-tab  id="accountAdditional" *ngIf="!isDepositAccountType">
                <ng-template ngbTabTitle><span [popover]="popAdditional" triggers="">Additional</span></ng-template>
                <ng-template ngbTabContent>
                  <p></p>
                  <account-additional-info [accountAdditional]="account?.additionalInfo"></account-additional-info>
                </ng-template>
              </ngb-tab>

              <ngb-tab id="accountHistory">
                <ng-template ngbTabTitle><span [popover]="popHistory" placement="bottom" triggers="">History</span></ng-template>
                <ng-template ngbTabContent>
                  <p></p>
                  <account-history [accountType]="account?.accountType" [history]="account?.history" [searching]="searchingAccountHistory"></account-history>
                </ng-template>
              </ngb-tab>

            </ngb-tabset>

          </div>
        </div>

      </div>
      <div class="ibox-content" *ngIf="searchingAccountInfo">
        <waiting-backend></waiting-backend>
        Searching for account...
      </div>
    </div>

    <div class="ibox">
      <div class="ibox-title" id="relatedInfo">
        <h5>Related Info</h5>
        <iboxtools style="color: white;"></iboxtools>
      </div>
      <div class="ibox-content">
        <div class="row">
          <div class="col-lg-12">
            <ngb-tabset #tabSetAdditional>
              <ngb-tab id="additionalAccounts">
                <ng-template ngbTabTitle><span [popover]="popAccounts" triggers="">Related accounts <tab-counter [data]="account?.customer?.accounts" [searching]="searchingAccounts"></tab-counter></span></ng-template>
                <ng-template ngbTabContent>
                  <p></p>
                  <accounts-table #additionalAccounts [hasToSaveParams]="false" [hasCreateButton]="false" [accounts]="account?.customer?.accounts" [searching]="searchingAccounts" [excluded]="account"></accounts-table>
                </ng-template>
              </ngb-tab>
              <ngb-tab id="additionalCoBorrowers">
                <ng-template ngbTabTitle><span [popover]="popCoborrowers" triggers="">Co-borrowers <tab-counter [data]="account?.customer?.coBorrowers" [searching]="searchingCoborrowers"></tab-counter></span></ng-template>
                <ng-template ngbTabContent>
                  <p></p>
                  <customers-table (onCall)="makeCall($event)" [customers]="account?.customer?.coBorrowers" [searching]="searchingCoborrowers"></customers-table>
                </ng-template>
              </ngb-tab>

              <ngb-tab [id]="(processCases && processCases.length) > 0 &&  hasNotAllClosedCases ? 'additionalCases' : 'noAdd'" *ngIf="canShowTicklerProcesses">
                <ng-template ngbTabTitle><span>Cases <tab-counter [data]="processCases" [searching]="searchingProcessCases"></tab-counter></span></ng-template>
                <ng-template ngbTabContent>
                  <p></p>

                 <tickler-cases-table
                   [searchingProcessCases]="searchingProcessCases"
                   [account]="account"
                   [isInRelatedInfo]="true"
                   [ticklerProcessCases]="processCases"
                   [processCase]="currentProcessCase"
                   (onSearchCases)="loadCaseTicklers($event)">
                 </tickler-cases-table>

                  <ng-container *ngIf="processCases?.length > 0">
                  <hr/>
                  <h4 style="margin-bottom: 20px;">Ticklers</h4>
                  <process-case-tickler-table
                    [ticklerTypes]="ticklerTypes"
                    [hasToShowNewButton]="false"
                    [currentProcessCase]="currentProcessCase"
                    [processCaseTicklers]="processCaseTicklers"
                    [searchingCaseTicklers]="searchingCaseTicklers"
                    (onAddTicklerCase)="refreshCaseTicklers()">
                  </process-case-tickler-table>
                  </ng-container>
                </ng-template>
              </ngb-tab>
            </ngb-tabset>

          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-5">
    <div class="ibox">
      <div class="ibox-title">
        <!--dynamic title-->
        <h5>{{resultModeText}}</h5>
        <iboxtools #newCall [popover]="newCallToggle" triggers=""></iboxtools>
      </div>
      <div class="ibox-content">
        <div>
          <p></p>
          <new-call-record
            #newCallRecord
            [hidden]="resultsMode !== NEW_RECORD_MODE"
            [showCallLater]="isCampaignRecordCall"
            [isAutoDial]="isAutoDial"
            [call]="lastOrCurrentCall"
            [callState]="lastOrCurrentCall?.state"
            [callFromUIType]="callingFromUIType"
            [callingFromUIIsCoBorrower]="callingFromUIIsCoBorrower"
            [account]="account"
            (onSave)="recordCall($event)"
            (onCancelMode)="cancelCallRecordMode()"
            (onCreateProcessMode)="createProcessMode()"
            (onOpenRequest)="openNewCall()">
          </new-call-record>
          <!--cases-->
          <new-process-case
            [hidden]="resultsMode !== NEW_PROCESS_MODE"
            [processes]="processes"
            [account]="account"
            [customer]="account?.customer"
            saveText="Save and quit"
            (caseCreated)="processCaseCreated()"
            (onCancel)="newCallRecordMode()">
          </new-process-case>
          <!--cancel call record-->
          <cancel-call-record
            [hidden]="resultsMode !== CANCEL_CALL_MODE"
            [cancelReasons]="cancelReasons"
            [waitingResponse]="waitingResponse"
            (cancelCall)="cancelCall($event)"
            (onCancel)="newCallRecordMode()">
          </cancel-call-record>
        </div>
      </div>
    </div>

    <div class="ibox">
      <div class="ibox-title">
        <h5>Previous Contacts</h5>
        <iboxtools></iboxtools>
        <span *ngIf="!searchingTodayContacts" class="pull-right todayContacts" [class.red]="account?.customer?.todayContacts >= 6"> Attempts today:
          <span>{{account?.customer?.todayContacts}}</span>
        </span>

        <div *ngIf="searchingTodayContacts" class="pull-right searchingContacts"><waiting-backend></waiting-backend> Searching...</div>


      </div>
      <div class="ibox-content">
        <div id="ct" class="row">
          <div class="col-lg-12">
            <ngb-tabset #tabSetContacts>
              <ngb-tab id="contactsCalls">
                <ng-template ngbTabTitle><span [popover]="popCalls" triggers="">Calls <tab-counter [data]="account?.customer?.callRecords" [searching]="searchingCalls"></tab-counter></span></ng-template>
                <ng-template ngbTabContent>
                  <p></p>
                  <customer-call-records [searching]="searchingCalls" [records]="account?.customer?.callRecords"></customer-call-records>
                </ng-template>
              </ngb-tab>
              <ngb-tab id="contactsNotes">
                <ng-template ngbTabTitle><span [popover]="popNotes" triggers="">Notes <tab-counter [data]="account?.customer?.notes" [searching]="searchingNotes"></tab-counter></span></ng-template>
                <ng-template ngbTabContent>
                  <p></p>
                  <customer-notes [searching]="searchingNotes" [notes]="account?.customer?.notes"></customer-notes>
                </ng-template>
              </ngb-tab>
              <ngb-tab id="contactsAlerts">
                <ng-template ngbTabTitle><span [popover]="popAlerts" triggers="">Alerts <tab-counter [data]="account?.customer?.alerts" [searching]="searchingAlerts"></tab-counter></span></ng-template>
                <ng-template ngbTabContent>
                  <p></p>
                  <customer-notes [searching]="searchingAlerts" [notes]="account?.customer?.alerts"></customer-notes>
                </ng-template>
              </ngb-tab>
              <ngb-tab id="callNotes">
                <ng-template ngbTabTitle>Memo notes <tab-counter [data]="currentMemoNotes" [searching]="searchingCallNotes"></tab-counter></ng-template>
                <ng-template ngbTabContent>
                  <p></p>
                  <call-notes
                    [isByAccount]="isByAccount"
                    [account]="account"
                    [memoNotes]="account?.customer?.callNotes"
                    [searchingCallNotes]="searchingCallNotes"
                    (onRefresh)="refreshMemoNoteValues($event)">
                  </call-notes>
                </ng-template>
              </ngb-tab>
            </ngb-tabset>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>


